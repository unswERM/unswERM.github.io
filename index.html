<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Token Creation Example</title>
    <script src="https://prod-apsoutheast-a.online.tableau.com/t/infs3605/views/INFS3605/Dashboard1"></script>
    <script>
        function createToken(userName, kid, secret, iss, scp) {
            var header = {
                "alg": "HS256",
                "typ": "JWT",
                "iss": "aaabcaba-2e10-4302-b912-827772344fd4", //CONNECTED APP ID
                "kid": "ad9d5b7d-36e8-4d47-945b-b2393f5bbd2c", //CONNECTED APP SECRET ID
            };
            var stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
            var encodedHeader = base64url(stringifiedHeader);
            var claimSet = {
                "sub": "z5260197@ad.unsw.edu.au", // THE USER NAME, like aalteirac@tableau.com
                "aud":"tableau",
                "nbf":Math.round(new Date().getTime()/1000)-100,
                "jti":new Date().getTime().toString(),
                "iss": iss,
                "scp": scp.split(","),
                "exp": Math.round(new Date().getTime()/1000)+100
            };
            var stringifiedData = CryptoJS.enc.Utf8.parse(JSON.stringify(claimSet));
            var encodedData = base64url(stringifiedData);
            var token = encodedHeader + "." + encodedData;
            var signature = CryptoJS.HmacSHA256(token, secret); //CONNECTED APP SECRET
            signature = base64url(signature);
            var signedToken = token + "." + signature;
            return signedToken;
        }

        function base64url(source) {
            encodedSource = CryptoJS.enc.Base64.stringify(source);
            encodedSource = encodedSource.replace(/=+$/, '');
            encodedSource = encodedSource.replace(/\+/g, '-');
            encodedSource = encodedSource.replace(/\//g, '_');
            return encodedSource;
        }
    </script>
</head>
<body>
<script type='module' src='https://prod-apsoutheast-a.online.tableau.com/javascripts/api/tableau.embedding.3.latest.min.js'>
</script>
<tableau-viz id='tableau-viz' src='https://prod-apsoutheast-a.online.tableau.com/t/infs3605/views/INFS3605/Dashboard1' width='1280' height='570' hide-tabs toolbar='bottom' >
</tableau-viz>
</body>
</html>
